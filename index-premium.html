<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Habits ‚Äî Daily Rituals</title>
  <meta name="theme-color" content="#1a1a2e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      /* === NIGHT MODE (Default - Aurora/Twilight) === */
      --bg-deep: #1a1a2e;
      --bg-mid: #16213e;
      --bg-card: rgba(255,255,255,0.08);
      --bg-card-hover: rgba(255,255,255,0.12);
      
      --text: #ffffff;
      --text-dim: rgba(255,255,255,0.85);
      --text-muted: rgba(255,255,255,0.6);
      
      --accent-pink: #ff6b9d;
      --accent-orange: #ffa552;
      --accent-yellow: #ffd93d;
      --accent-teal: #6dd5ed;
      --accent-purple: #c471ed;
      
      --glow-pink: rgba(255,107,157,0.4);
      --glow-orange: rgba(255,165,82,0.4);
      --glow-teal: rgba(109,213,237,0.4);
      --glow-purple: rgba(196,113,237,0.4);
      
      --success: #6dd5ed;
      --success-soft: rgba(109,213,237,0.2);
      
      --sleep: #c471ed;
      --water: #6dd5ed;
      --movement: #ff6b9d;
      --nutrition: #6dd5ed;
      
      --border: rgba(255,255,255,0.2);
      --radius: 20px;
      --radius-sm: 12px;
      --radius-pill: 100px;
      
      /* Gradient backgrounds */
      --bg-gradient: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #1a1a2e 50%, #2d1b4e 75%, #1a1a2e 100%);
      --bg-aurora: 
        radial-gradient(ellipse at 20% 20%, rgba(196,113,237,0.15) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(255,107,157,0.1) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(109,213,237,0.08) 0%, transparent 60%);
    }
    
    /* === DAY MODE - Soft Cantaloupe === */
    body.day-mode {
      --bg-deep: #ffeaa7;
      --bg-mid: #fdcb6e;
      --bg-card: rgba(255,255,255,0.6);
      --bg-card-hover: rgba(255,255,255,0.8);
      
      /* Dark text for contrast on light background */
      --text: #1a1a2e;
      --text-dim: rgba(26,26,46,0.8);
      --text-muted: rgba(26,26,46,0.6);
      
      /* Vibrant accents to pop against yellow-orange background */
      --accent-pink: #e11d48;
      --accent-orange: #ea580c;
      --accent-yellow: #ca8a04;
      --accent-teal: #0d9488;
      --accent-purple: #6366f1;
      
      --glow-pink: rgba(225,29,72,0.3);
      --glow-orange: rgba(234,88,12,0.3);
      --glow-teal: rgba(13,148,136,0.3);
      --glow-purple: rgba(99,102,241,0.4);
      
      --success: #059669;
      --success-soft: rgba(5,150,105,0.15);
      
      --sleep: #6366f1;
      --water: #0d9488;
      --movement: #e11d48;
      --nutrition: #059669;
      
      --border: rgba(0,0,0,0.1);
      
      /* Soft Cantaloupe gradient */
      background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 30%, #f9a825 70%, #fdcb6e 100%) !important;
    }
    
    body.day-mode::before {
      background: radial-gradient(ellipse at 30% 20%, rgba(255,234,167,0.5) 0%, transparent 50%) !important;
    }
    
    /* Day mode specific overrides - indigo/purple buttons on cantaloupe background */
    body.day-mode .logo {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      box-shadow: 0 0 20px var(--glow-purple);
    }
    body.day-mode .date-btn {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      box-shadow: 0 4px 15px var(--glow-purple);
      color: white;
    }
    body.day-mode .phase-fill {
      background: linear-gradient(90deg, #6366f1, #8b5cf6, #a855f7);
    }
    body.day-mode .fab {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      box-shadow: 0 8px 25px var(--glow-purple);
      color: white;
    }
    body.day-mode .btn-primary {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: white;
    }
    body.day-mode .ring-progress {
      stroke: #6366f1;
    }
    body.day-mode .ring-text {
      color: #6366f1;
    }
    body.day-mode .chip.on {
      background: var(--success-soft);
      border-color: var(--success);
      box-shadow: 0 0 10px rgba(5,150,105,0.3);
    }
    body.day-mode .chip.on .chip-dot {
      background: var(--success);
      border-color: var(--success);
      color: white;
      box-shadow: 0 0 8px rgba(5,150,105,0.4);
    }
    body.day-mode .water-btn {
      border-color: var(--accent-teal);
      color: var(--accent-teal);
    }
    body.day-mode .water-btn:hover {
      background: var(--accent-teal);
      color: white;
    }
    body.day-mode .water-num {
      color: var(--text);
    }
    body.day-mode .milestone-title {
      background: linear-gradient(90deg, var(--accent-orange), var(--accent-pink), var(--accent-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    body.day-mode .card {
      background: rgba(255,255,255,0.6);
      border-color: rgba(0,0,0,0.08);
    }
    body.day-mode .card-title {
      color: var(--text-muted);
    }
    body.day-mode .card-avg {
      color: var(--text-muted);
    }
    body.day-mode .section {
      background: rgba(255,255,255,0.6);
      border-color: rgba(0,0,0,0.08);
    }
    body.day-mode .sec-name {
      color: var(--text);
    }
    body.day-mode .nav-link {
      background: rgba(255,255,255,0.6);
      border-color: rgba(0,0,0,0.1);
      color: var(--text-dim);
    }
    body.day-mode .nav-link:hover {
      background: rgba(255,255,255,0.8);
      color: var(--accent-orange);
      border-color: var(--accent-orange);
    }
    body.day-mode .date-nav {
      background: rgba(255,255,255,0.6);
      border-color: rgba(0,0,0,0.08);
    }
    body.day-mode .date-main,
    body.day-mode .date-sub {
      color: var(--text);
    }
    body.day-mode .steps-bar-fill {
      background: linear-gradient(to top, #6366f1, #8b5cf6, #a855f7);
    }
    body.day-mode .water-bar-fill {
      background: linear-gradient(to top, var(--accent-teal), #14b8a6, #5eead4);
    }
    body.day-mode .big-input {
      color: var(--text);
    }
    body.day-mode .big-input::placeholder {
      color: var(--text-muted);
    }
    body.day-mode .chip-text {
      color: var(--text-dim);
    }
    body.day-mode .chip.on .chip-text {
      color: var(--text);
    }
    body.day-mode .chip-dot {
      border-color: var(--text-muted);
    }
    /* Dark empty progress bars in day mode */
    body.day-mode .steps-bar-track,
    body.day-mode .water-bar-track {
      background: rgba(0,0,0,0.15);
    }
    body.day-mode .ring-bg {
      stroke: rgba(0,0,0,0.15);
    }
    body.day-mode .phase-track {
      background: rgba(0,0,0,0.12);
    }
    /* Darker collapse arrows */
    body.day-mode .sec-toggle {
      color: var(--text-dim);
    }
    /* Movement/Reading items shading */
    body.day-mode .item {
      background: rgba(255,255,255,0.6);
      border-color: rgba(0,0,0,0.08);
    }
    
    /* === SUNSET TRANSITION MODE === */
    body.sunset-mode {
      --bg-deep: #2d1b4e;
      --bg-mid: #1a1a2e;
      --bg-card: rgba(255,255,255,0.06);
      --bg-card-hover: rgba(255,255,255,0.1);
      
      --text: #f0f0f0;
      --text-dim: rgba(255,255,255,0.7);
      --text-muted: rgba(255,255,255,0.5);
      
      --bg-gradient: linear-gradient(135deg, #2d1b4e 0%, #4a1942 30%, #1a1a2e 70%, #16213e 100%);
      --bg-aurora: 
        radial-gradient(ellipse at 50% 0%, rgba(255,107,157,0.2) 0%, transparent 50%),
        radial-gradient(ellipse at 30% 50%, rgba(255,165,82,0.15) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 80%, rgba(196,113,237,0.15) 0%, transparent 50%);
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      min-height: 100vh;
      color: var(--text);
      padding: 16px;
      padding-bottom: 120px;
      font-size: 16px;
      line-height: 1.5;
      background: var(--bg-gradient);
      background-attachment: fixed;
      position: relative;
      transition: background 1s ease, color 0.5s ease;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: var(--bg-aurora);
      pointer-events: none;
      z-index: 0;
      transition: background 1s ease;
    }
    
    body > * { position: relative; z-index: 1; }
    
    /* Theme indicator */
    .theme-indicator {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 11px;
      color: var(--text-muted);
      background: var(--bg-card);
      padding: 4px 12px;
      border-radius: var(--radius-pill);
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 1001;
      backdrop-filter: blur(10px);
    }
    .theme-indicator.show {
      opacity: 1;
    }
      --radius-pill: 100px;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      min-height: 100vh;
      color: var(--text);
      padding: 16px;
      padding-bottom: 120px;
      font-size: 16px;
      line-height: 1.5;
      
      /* Aurora gradient background */
      background: linear-gradient(135deg, 
        #1a1a2e 0%, 
        #16213e 25%, 
        #1a1a2e 50%,
        #2d1b4e 75%,
        #1a1a2e 100%
      );
      background-attachment: fixed;
      position: relative;
    }
    
    /* Animated aurora glow overlay */
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(196,113,237,0.15) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(255,107,157,0.1) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(109,213,237,0.08) 0%, transparent 60%);
      pointer-events: none;
      z-index: 0;
    }
    
    body > * { position: relative; z-index: 1; }
    
    /* Header */
    .header { padding: 20px 0; margin-bottom: 20px; }
    .header-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px; }
    .brand { display: flex; align-items: center; gap: 12px; }
    .logo {
      width: 48px; height: 48px; border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple));
      display: flex; align-items: center; justify-content: center; font-size: 22px;
      box-shadow: 0 0 30px var(--glow-pink), 0 0 60px var(--glow-purple);
      animation: pulse-glow 3s ease-in-out infinite;
    }
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px var(--glow-pink), 0 0 40px var(--glow-purple); }
      50% { box-shadow: 0 0 30px var(--glow-pink), 0 0 60px var(--glow-purple); }
    }
    .brand h1 { font-family: 'Space Grotesk', sans-serif; font-size: 24px; font-weight: 700; letter-spacing: -0.02em; }
    .brand .tagline { font-size: 12px; color: var(--text-dim); margin-top: 2px; }
    .nav-links { display: flex; gap: 8px; }
    .nav-link {
      width: 40px; height: 40px; border-radius: 50%; border: 1px solid var(--border);
      background: var(--bg-card); color: var(--text-dim); font-size: 15px; cursor: pointer;
      display: flex; align-items: center; justify-content: center; text-decoration: none;
      transition: all 0.3s; backdrop-filter: blur(10px);
    }
    .nav-link:hover { 
      background: var(--bg-card-hover); 
      color: var(--accent-teal); 
      border-color: var(--accent-teal);
      box-shadow: 0 0 20px var(--glow-teal);
    }
    
    /* Date Nav - Glassmorphism */
    .date-nav {
      display: flex; align-items: center; gap: 12px; padding: 16px;
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: var(--radius); backdrop-filter: blur(20px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .date-btn {
      width: 44px; height: 44px; border-radius: 50%; border: none;
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
      color: white; font-size: 18px; font-weight: 600;
      cursor: pointer; transition: all 0.3s;
      box-shadow: 0 4px 15px var(--glow-purple);
    }
    .date-btn:hover { transform: scale(1.1); box-shadow: 0 6px 25px var(--glow-pink); }
    .date-btn:active { transform: scale(0.95); }
    .date-center { flex: 1; text-align: center; }
    .date-main { font-family: 'Space Grotesk', sans-serif; font-size: 18px; font-weight: 600; }
    .date-sub { font-size: 11px; color: var(--text-muted); margin-top: 2px; }
    
    /* Progress Ring - Glowing */
    .ring-wrap { position: relative; width: 72px; height: 72px; }
    .ring { transform: rotate(-90deg); }
    .ring-bg { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 5; }
    .ring-progress { 
      fill: none; 
      stroke: url(#auroraGrad); 
      stroke-width: 5; 
      stroke-linecap: round; 
      transition: stroke-dashoffset 0.6s;
      filter: drop-shadow(0 0 6px var(--glow-teal));
    }
    .ring-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-family: 'Space Grotesk'; font-size: 18px; font-weight: 700; color: var(--accent-teal); }
    
    /* Phase Bar */
    .phase { margin-top: 20px; }
    .phase-label { display: flex; justify-content: space-between; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); margin-bottom: 8px; }
    .phase-track { height: 6px; background: rgba(255,255,255,0.1); border-radius: var(--radius-pill); overflow: hidden; }
    .phase-fill { 
      height: 100%; 
      background: linear-gradient(90deg, var(--accent-purple), var(--accent-pink), var(--accent-orange)); 
      border-radius: var(--radius-pill); 
      box-shadow: 0 0 20px var(--glow-pink);
      transition: width 0.6s;
    }
    
    /* Cards - Glowing borders on hover */
    .quick-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; }
    .card {
      background: rgba(255,255,255,0.06); 
      border: 1px solid rgba(255,255,255,0.15); 
      border-radius: var(--radius);
      padding: 18px; 
      position: relative; 
      overflow: hidden; 
      backdrop-filter: blur(20px);
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
      min-height: 140px;
    }
    .card::before { 
      content: ''; 
      position: absolute; 
      top: 0; left: 0; right: 0; 
      height: 3px; 
      background: linear-gradient(90deg, var(--accent-start, var(--accent-purple)), var(--accent-end, var(--accent-pink))); 
      opacity: 0.8; 
    }
    .card:hover { 
      border-color: rgba(255,255,255,0.25);
      box-shadow: 0 0 30px var(--card-glow, var(--glow-purple));
      transform: translateY(-2px);
    }
    .card.sleep { --accent-start: var(--accent-purple); --accent-end: var(--accent-pink); --card-glow: var(--glow-purple); }
    .card.water { --accent-start: var(--accent-teal); --accent-end: var(--accent-purple); --card-glow: var(--glow-teal); }
    .card.movement { --accent-start: var(--accent-pink); --accent-end: var(--accent-orange); --card-glow: var(--glow-pink); }
    
    .card-head { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
    .card-icon { 
      width: 32px; height: 32px; border-radius: 50%; 
      display: flex; align-items: center; justify-content: center; font-size: 15px; 
      background: linear-gradient(135deg, var(--accent-start, var(--accent-purple)), var(--accent-end, var(--accent-pink)));
      box-shadow: 0 0 15px var(--card-glow, var(--glow-purple));
    }
    .card-title { font-size: 12px; font-weight: 600; color: rgba(255,255,255,0.8); text-transform: uppercase; letter-spacing: 0.05em; }
    .card-value { font-family: 'Space Grotesk'; font-size: 32px; font-weight: 700; line-height: 1; color: #ffffff; }
    .card-unit { font-size: 13px; color: rgba(255,255,255,0.6); margin-left: 4px; }
    .card-avg { font-size: 11px; color: rgba(255,255,255,0.5); margin-top: auto; padding-top: 8px; }
    
    /* REHIT Dots */
    .rehit-dots { display: flex; gap: 6px; margin-left: auto; }
    .rehit-dot { 
      width: 10px; height: 10px; 
      border-radius: 50%; 
      background: rgba(255,255,255,0.2); 
      transition: all 0.3s;
    }
    .rehit-dot.on { 
      background: var(--accent-teal); 
      box-shadow: 0 0 8px var(--glow-teal);
    }
    body.day-mode .rehit-dot {
      background: rgba(0,0,0,0.15);
    }
    body.day-mode .rehit-dot.on {
      background: var(--success);
      box-shadow: 0 0 8px rgba(5,150,105,0.4);
    }
    
    .big-input { width: 100%; background: transparent; border: none; font-family: 'Space Grotesk'; font-size: 32px; font-weight: 700; color: var(--text); outline: none; }
    .big-input::placeholder { color: var(--text-muted); }
    .big-input:focus { color: var(--accent-teal); }
    
    /* Steps Progress Bar */
    .steps-bar-wrap { display: flex; flex-direction: column; align-items: center; gap: 4px; }
    .steps-bar-track { 
      width: 12px; height: 60px; 
      background: rgba(255,255,255,0.1); 
      border-radius: 6px; 
      overflow: hidden;
      position: relative;
    }
    .steps-bar-fill { 
      position: absolute;
      bottom: 0; left: 0; right: 0;
      background: linear-gradient(to top, var(--accent-pink), var(--accent-orange), var(--accent-yellow)); 
      border-radius: 6px;
      transition: height 0.5s ease;
      box-shadow: 0 0 10px var(--glow-orange);
    }
    .steps-bar-goal { font-size: 9px; color: var(--text-muted); font-weight: 600; }
    
    /* Water */
    .water-row { display: flex; align-items: center; gap: 12px; }
    .water-btn { 
      width: 38px; height: 38px; border-radius: 50%; 
      border: 2px solid var(--accent-teal); background: transparent; 
      color: var(--accent-teal); font-size: 18px; cursor: pointer; transition: all 0.3s; 
    }
    .water-btn:hover { 
      background: var(--accent-teal); 
      color: var(--bg-deep); 
      box-shadow: 0 0 20px var(--glow-teal);
    }
    .water-btn:active { transform: scale(0.9); }
    .water-num { font-family: 'Space Grotesk'; font-size: 32px; font-weight: 700; min-width: 44px; text-align: center; color: #ffffff; }
    
    /* Water Progress Bar */
    .water-bar-wrap { display: flex; flex-direction: column; align-items: center; gap: 4px; }
    .water-bar-track { 
      width: 12px; height: 60px; 
      background: rgba(255,255,255,0.1); 
      border-radius: 6px; 
      overflow: hidden;
      position: relative;
    }
    .water-bar-fill { 
      position: absolute;
      bottom: 0; left: 0; right: 0;
      background: linear-gradient(to top, var(--accent-teal), #6dd5ed, #a5f3fc); 
      border-radius: 6px;
      transition: height 0.5s ease;
      box-shadow: 0 0 10px var(--glow-teal);
    }
    .water-bar-goal { font-size: 9px; color: rgba(255,255,255,0.6); font-weight: 600; }
    
    /* Sections */
    .section { 
      background: rgba(255,255,255,0.06); 
      border: 1px solid rgba(255,255,255,0.15); 
      border-radius: var(--radius); 
      padding: 18px; 
      margin-bottom: 12px; 
      backdrop-filter: blur(20px); 
      transition: all 0.3s;
    }
    .section:hover { border-color: rgba(255,255,255,0.2); }
    .sec-head { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; cursor: pointer; }
    .sec-title { display: flex; align-items: center; gap: 10px; }
    .sec-icon { 
      width: 28px; height: 28px; border-radius: 50%; 
      display: flex; align-items: center; justify-content: center; font-size: 13px; 
      background: linear-gradient(135deg, var(--icon-start, var(--accent-purple)), var(--icon-end, var(--accent-pink)));
      box-shadow: 0 0 12px var(--icon-glow, var(--glow-purple));
    }
    .sec-name { font-size: 14px; font-weight: 600; color: #ffffff; }
    .sec-toggle { color: rgba(255,255,255,0.5); font-size: 11px; transition: transform 0.3s; }
    .sec-head.collapsed .sec-toggle { transform: rotate(-90deg); }
    .sec-content { transition: max-height 0.3s, opacity 0.3s; overflow: hidden; }
    .sec-content.collapsed { max-height: 0; opacity: 0; }
    
    /* Chips - Glowing when active */
    .chips { display: flex; flex-wrap: wrap; gap: 8px; }
    .chip {
      display: flex; align-items: center; gap: 6px; padding: 8px 14px;
      background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: var(--radius-pill);
      cursor: pointer; transition: all 0.3s; user-select: none;
    }
    .chip:hover { background: rgba(255,255,255,0.1); }
    .chip:active { transform: scale(0.97); }
    .chip.on { 
      background: var(--success-soft); 
      border-color: var(--success); 
      box-shadow: 0 0 15px var(--glow-teal);
    }
    .chip-dot { 
      width: 18px; height: 18px; border-radius: 50%; 
      border: 2px solid var(--text-muted); 
      display: flex; align-items: center; justify-content: center; 
      font-size: 10px; transition: all 0.3s; 
    }
    .chip.on .chip-dot { 
      background: var(--success); 
      border-color: var(--success); 
      color: var(--bg-deep); 
      box-shadow: 0 0 10px var(--glow-teal);
    }
    .chip-text { font-size: 13px; font-weight: 500; color: var(--text-dim); transition: color 0.3s; }
    .chip.on .chip-text { color: var(--text); }
    .chip input { display: none; }
    
    /* Inputs */
    .field { margin-bottom: 14px; }
    .field-label { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); margin-bottom: 6px; display: block; }
    .input { 
      width: 100%; padding: 14px; 
      background: rgba(255,255,255,0.05); 
      border: 1px solid var(--border); 
      border-radius: var(--radius-sm); 
      color: var(--text); font-size: 15px; outline: none; transition: all 0.3s; 
    }
    .input:focus { 
      border-color: var(--accent-teal); 
      box-shadow: 0 0 20px var(--glow-teal);
    }
    .input::placeholder { color: var(--text-muted); }
    textarea.input { min-height: 90px; resize: vertical; font-family: inherit; line-height: 1.5; }
    
    /* Buttons */
    .btn { display: inline-flex; align-items: center; gap: 6px; padding: 10px 16px; border-radius: var(--radius-sm); font-size: 13px; font-weight: 600; cursor: pointer; border: none; transition: all 0.3s; }
    .btn-secondary { background: rgba(255,255,255,0.08); color: var(--text-dim); border: 1px solid var(--border); }
    .btn-secondary:hover { background: rgba(255,255,255,0.12); color: var(--text); }
    .btn-primary { 
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink)); 
      color: white; padding: 14px 24px; 
      box-shadow: 0 4px 20px var(--glow-purple);
    }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 30px var(--glow-pink); }
    
    /* Items */
    .items { margin-bottom: 12px; }
    .item { display: flex; align-items: center; justify-content: space-between; padding: 12px 14px; background: rgba(255,255,255,0.15); border: 1px solid var(--border); border-radius: var(--radius-sm); margin-bottom: 6px; }
    .item-text { font-size: 13px; }
    .item-del { background: none; border: none; color: var(--text-muted); font-size: 16px; cursor: pointer; }
    .item-del:hover { color: var(--accent-pink); }
    
    /* Body Grid */
    .body-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .body-cell { background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 12px; }
    .body-label { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); margin-bottom: 4px; }
    .body-input { width: 100%; background: transparent; border: none; font-family: 'Space Grotesk'; font-size: 18px; font-weight: 600; color: var(--text); outline: none; }
    .body-pct { font-family: 'Space Grotesk'; font-size: 18px; font-weight: 600; color: var(--accent-teal); }
    
    /* FAB - Glowing */
    .fab { 
      position: fixed; bottom: 24px; right: 24px; 
      width: 60px; height: 60px; border-radius: 50%; 
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink)); 
      border: none; color: white; font-size: 24px; cursor: pointer; 
      box-shadow: 0 8px 30px var(--glow-purple);
      z-index: 100; transition: all 0.3s; 
      animation: fab-pulse 2s ease-in-out infinite;
    }
    @keyframes fab-pulse {
      0%, 100% { box-shadow: 0 8px 30px var(--glow-purple); }
      50% { box-shadow: 0 8px 40px var(--glow-pink), 0 0 60px var(--glow-purple); }
    }
    .fab:hover { transform: scale(1.1); }
    .fab:active { transform: scale(0.95); }
    .fab.open { transform: rotate(45deg); background: var(--bg-card); animation: none; }
    
    .fab-menu { position: fixed; bottom: 100px; right: 24px; display: flex; flex-direction: column; gap: 10px; opacity: 0; transform: translateY(20px); pointer-events: none; transition: all 0.3s; z-index: 99; }
    .fab-menu.open { opacity: 1; transform: translateY(0); pointer-events: auto; }
    .fab-item { 
      display: flex; align-items: center; gap: 10px; padding: 10px 16px; 
      background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-pill); 
      backdrop-filter: blur(20px); cursor: pointer; transition: all 0.3s; white-space: nowrap; 
    }
    .fab-item:hover { background: var(--bg-card-hover); transform: translateX(-8px); box-shadow: 0 0 20px var(--glow-purple); }
    .fab-icon { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; }
    .fab-label { font-size: 14px; font-weight: 600; color: var(--text); }
    
    /* Sticky */
    .sticky { position: fixed; top: 0; left: 0; right: 0; background: rgba(26,26,46,0.95); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); padding: 10px 16px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; transform: translateY(-100%); transition: transform 0.3s; }
    .sticky.visible { transform: translateY(0); }
    .sticky-date { font-size: 14px; font-weight: 600; }
    .sticky-btns { display: flex; gap: 8px; }
    .sticky-btns button { width: 32px; height: 32px; border-radius: 50%; border: none; background: var(--bg-card); color: var(--text-dim); font-size: 13px; cursor: pointer; }
    
    /* Milestone - Aurora themed */
    .milestone { position: fixed; inset: 0; background: rgba(26,26,46,0.95); display: flex; align-items: center; justify-content: center; z-index: 2000; opacity: 0; pointer-events: none; transition: opacity 0.3s; backdrop-filter: blur(10px); }
    .milestone.show { opacity: 1; pointer-events: auto; }
    .milestone-box { text-align: center; animation: pop 0.5s cubic-bezier(0.34,1.56,0.64,1); }
    @keyframes pop { 0%{transform:scale(0.5);opacity:0} 100%{transform:scale(1);opacity:1} }
    .milestone-emoji { font-size: 72px; animation: float 2s ease-in-out infinite; }
    @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-15px)} }
    .milestone-title { font-family: 'Space Grotesk'; font-size: 26px; font-weight: 700; margin-top: 16px; background: linear-gradient(90deg, var(--accent-teal), var(--accent-purple), var(--accent-pink)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .milestone-sub { font-size: 15px; color: var(--text-dim); margin-top: 8px; }
    .milestone-btn { margin-top: 28px; padding: 14px 32px; background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink)); border: none; border-radius: var(--radius-pill); font-size: 16px; font-weight: 600; color: white; cursor: pointer; box-shadow: 0 8px 30px var(--glow-purple); }
    
    /* Modal */
    .modal { position: fixed; inset: 0; background: rgba(26,26,46,0.9); display: flex; align-items: center; justify-content: center; z-index: 2000; opacity: 0; pointer-events: none; transition: opacity 0.3s; backdrop-filter: blur(10px); padding: 16px; }
    .modal.show { opacity: 1; pointer-events: auto; }
    .modal-content { background: var(--bg-mid); border: 1px solid var(--border); border-radius: var(--radius); width: 100%; max-width: 360px; animation: pop 0.3s cubic-bezier(0.34,1.56,0.64,1); overflow: hidden; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 18px; border-bottom: 1px solid var(--border); }
    .modal-close { width: 34px; height: 34px; border-radius: 50%; border: none; background: rgba(255,255,255,0.1); color: var(--text-muted); font-size: 16px; cursor: pointer; transition: all 0.3s; }
    .modal-close:hover { background: rgba(255,255,255,0.15); color: var(--text); }
    .modal-body { padding: 18px; }
    .modal-footer { padding: 18px; border-top: 1px solid var(--border); }
    
    /* Responsive */
    @media (max-width: 430px) {
      body { padding: 12px; }
      .quick-grid { gap: 10px; }
      .card { padding: 14px; }
      .card-value { font-size: 28px; }
      .big-input { font-size: 28px; }
    }
    @media (min-width: 768px) { body { max-width: 540px; margin: 0 auto; } }
    
    /* Settings Page Styles */
    .setting-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }
    .setting-row:last-child { border-bottom: none; }
    .setting-label { flex: 1; }
    .setting-title { display: block; font-size: 14px; font-weight: 600; color: var(--text); }
    .setting-desc { display: block; font-size: 11px; color: var(--text-muted); margin-top: 2px; }
    
    .time-input {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 8px 12px;
      color: var(--text);
      font-size: 14px;
      font-family: 'Space Grotesk', sans-serif;
      outline: none;
    }
    .time-input:focus { border-color: var(--accent-teal); }
    
    .theme-preview { display: flex; gap: 8px; }
    .theme-btn {
      width: 40px; height: 40px;
      border-radius: 50%;
      border: 2px solid var(--border);
      background: var(--bg-card);
      font-size: 18px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .theme-btn:hover { border-color: var(--accent-teal); transform: scale(1.1); }
    .theme-btn.active { border-color: var(--accent-teal); box-shadow: 0 0 15px var(--glow-teal); }
    
    /* Section List for Drag & Drop */
    .section-list { }
    .section-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      margin-bottom: 8px;
      cursor: grab;
      transition: all 0.2s;
    }
    .section-item:active { cursor: grabbing; }
    .section-item.dragging {
      opacity: 0.5;
      transform: scale(1.02);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    .section-item.drag-over {
      border-color: var(--accent-teal);
      background: var(--success-soft);
    }
    .section-item-drag {
      color: var(--text-muted);
      font-size: 16px;
      cursor: grab;
    }
    .section-item-icon { font-size: 18px; }
    .section-item-name { flex: 1; font-size: 14px; font-weight: 500; }
    .section-item-toggle {
      position: relative;
      width: 44px;
      height: 24px;
      background: var(--bg-deep);
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .section-item-toggle.on { background: var(--success); }
    .section-item-toggle::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: transform 0.2s;
    }
    .section-item-toggle.on::after { transform: translateX(20px); }
    .section-item-delete {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 16px;
      cursor: pointer;
      padding: 4px;
      opacity: 0.5;
      transition: all 0.2s;
    }
    .section-item-delete:hover { color: var(--accent-pink); opacity: 1; }
  </style>
</head>
<body>
  <div class="theme-indicator" id="themeIndicator">‚òÄÔ∏è Day Mode</div>
  
  <svg width="0" height="0" style="position:absolute">
    <defs>
      <linearGradient id="auroraGrad" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" style="stop-color:#c471ed"/>
        <stop offset="50%" style="stop-color:#ff6b9d"/>
        <stop offset="100%" style="stop-color:#6dd5ed"/>
      </linearGradient>
    </defs>
  </svg>

  <div id="stickyDateBar" class="sticky">
    <div class="sticky-date" id="stickyDateDisplay">Today</div>
    <div class="sticky-btns"><button id="stickyPrevBtn">‚Üê</button><button id="stickyNextBtn">‚Üí</button></div>
  </div>

  <div id="milestoneOverlay" class="milestone">
    <div class="milestone-box">
      <div class="milestone-emoji" id="milestoneEmoji">‚ú®</div>
      <div class="milestone-title" id="milestoneTitle">Amazing!</div>
      <div class="milestone-sub" id="milestoneSubtitle">You did something great!</div>
      <button class="milestone-btn" onclick="closeMilestone()">Continue</button>
    </div>
  </div>

  <!-- REHIT Modal -->
  <div id="rehitModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div style="display:flex;align-items:center;gap:10px">
          <div style="width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--accent-pink),var(--accent-orange));display:flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 0 15px var(--glow-pink)">üö¥</div>
          <div>
            <div style="font-family:'Space Grotesk';font-size:18px;font-weight:700">REHIT Stats</div>
            <div style="font-size:12px;color:var(--text-muted)">Enter your workout data</div>
          </div>
        </div>
        <button class="modal-close" onclick="closeRehitModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="body-grid">
          <div class="body-cell"><div class="body-label">Fitness Score</div><input type="number" inputmode="decimal" class="body-input" id="fitnessScore" step="0.1" placeholder="0.0"></div>
          <div class="body-cell"><div class="body-label">Calories</div><input type="number" inputmode="numeric" class="body-input" id="calories" placeholder="0"></div>
          <div class="body-cell"><div class="body-label">Peak Watts</div><input type="number" inputmode="numeric" class="body-input" id="peakWatts" placeholder="0"></div>
          <div class="body-cell"><div class="body-label">Watt Seconds</div><input type="number" inputmode="numeric" class="body-input" id="wattSeconds" placeholder="0"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="saveRehitAndClose()" style="width:100%">Save Stats</button>
      </div>
    </div>
  </div>

  <header class="header">
    <div class="header-top">
      <div class="brand">
        <div class="logo">‚ú¶</div>
        <div><h1>Habits</h1><div class="tagline">Phase 1 ¬∑ <span id="phaseInfo">--</span></div></div>
      </div>
      <div class="nav-links">
        <a href="#" id="weeklySummaryLink" class="nav-link">üìà</a>
        <a href="#" id="chartsBtn" class="nav-link">üìä</a>
        <a href="#" id="biomarkersBtn" class="nav-link">üß¨</a>
        <a href="#" id="settingsBtn" class="nav-link">‚öôÔ∏è</a>
      </div>
    </div>
    <div class="date-nav">
      <button class="date-btn" id="prevBtn">‚Üê</button>
      <div class="date-center">
        <div class="date-main" id="dateDisplay"></div>
      </div>
      <div class="ring-wrap">
        <svg class="ring" width="72" height="72" viewBox="0 0 72 72">
          <circle class="ring-bg" cx="36" cy="36" r="32"/>
          <circle class="ring-progress" id="completionProgress" cx="36" cy="36" r="32" stroke-dasharray="201" stroke-dashoffset="201"/>
        </svg>
        <div class="ring-text" id="completionNumber">0</div>
      </div>
      <button class="date-btn" id="nextBtn">‚Üí</button>
    </div>
    <div class="phase">
      <div class="phase-label"><span>Phase Progress</span><span id="phaseDaysRemaining">-- days left</span></div>
      <div class="phase-track"><div class="phase-fill" id="phaseProgressBar" style="width:0%"></div></div>
    </div>
  </header>

  <form id="healthForm">
    <div class="quick-grid">
      <div class="card sleep" id="sleepSection">
        <div class="card-head"><div class="card-icon">üåô</div><div class="card-title">Sleep</div></div>
        <div><input type="number" inputmode="decimal" class="big-input" id="sleepHours" step="0.1" placeholder="0"><span class="card-unit">hrs</span></div>
        <div class="card-avg">7-day avg: <span id="avgSleep">--</span></div>
      </div>
      <div class="card water" id="waterSection">
        <div class="card-head"><div class="card-icon">üíß</div><div class="card-title">Water</div></div>
        <div style="display:flex;align-items:center;gap:12px;">
          <div class="water-row" style="flex:1">
            <button type="button" class="water-btn" id="waterMinus">‚àí</button>
            <div class="water-num" id="waterCount">0</div>
            <button type="button" class="water-btn" id="waterPlus">+</button>
          </div>
          <div class="water-bar-wrap">
            <div class="water-bar-track">
              <div class="water-bar-fill" id="waterBarFill"></div>
            </div>
            <div class="water-bar-goal">6</div>
          </div>
        </div>
      </div>
      <div class="card movement">
        <div class="card-head"><div class="card-icon">üëü</div><div class="card-title">Steps</div></div>
        <div style="display:flex;align-items:center;gap:12px;">
          <input type="number" inputmode="numeric" class="big-input" id="steps" placeholder="0" style="flex:1">
          <div class="steps-bar-wrap">
            <div class="steps-bar-track">
              <div class="steps-bar-fill" id="stepsBarFill"></div>
            </div>
            <div class="steps-bar-goal">7.5k</div>
          </div>
        </div>
        <div class="card-avg">7-day avg: <span id="avgSteps">--</span></div>
      </div>
      <div class="card movement" id="rehitCard">
        <div class="card-head">
          <div class="card-icon">üö¥</div>
          <div class="card-title">REHIT</div>
          <div class="rehit-dots" id="rehitDots">
            <div class="rehit-dot"></div>
            <div class="rehit-dot"></div>
            <div class="rehit-dot"></div>
            <div class="rehit-dot"></div>
          </div>
        </div>
        <div class="chips" style="margin-top:8px">
          <div class="chip" id="rehit2Chip"><input type="checkbox" id="rehit2"><div class="chip-dot">‚úì</div><span class="chip-text">2√ó10</span></div>
          <div class="chip" id="rehit3Chip"><input type="checkbox" id="rehit3"><div class="chip-dot">‚úì</div><span class="chip-text">3√ó10</span></div>
        </div>
        <div id="rehitStats" style="display:none; margin-top:10px; padding-top:10px; border-top:1px solid var(--border);">
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:6px; font-size:12px;">
            <div><span style="color:var(--text-muted)">Score:</span> <span id="rehitScoreDisplay" style="color:var(--accent-teal);font-weight:600">--</span></div>
            <div><span style="color:var(--text-muted)">Cals:</span> <span id="rehitCalsDisplay" style="color:var(--accent-orange);font-weight:600">--</span></div>
            <div><span style="color:var(--text-muted)">Watts:</span> <span id="rehitWattsDisplay" style="color:var(--accent-pink);font-weight:600">--</span></div>
            <div><span style="color:var(--text-muted)">W-Sec:</span> <span id="rehitWsDisplay" style="color:var(--accent-purple);font-weight:600">--</span></div>
          </div>
          <button type="button" class="btn btn-secondary" id="editRehitBtn" style="width:100%;margin-top:8px;font-size:12px;padding:6px 10px;">Edit Stats</button>
        </div>
        <div class="card-avg">This week: <span id="rehitWeek">--</span></div>
      </div>
    </div>

    <div class="section" id="greysHabitsSection">
      <div class="sec-head"><div class="sec-title"><div class="sec-icon" style="--icon-start:#ffa552;--icon-end:#ffd93d;--icon-glow:var(--glow-orange)">üë∂</div><span class="sec-name">Grey's Habits</span></div><span class="sec-toggle">‚ñº</span></div>
      <div class="sec-content">
        <div class="chips">
          <div class="chip"><input type="checkbox" id="inhalerMorning"><div class="chip-dot">‚úì</div><span class="chip-text">Inhaler AM</span></div>
          <div class="chip"><input type="checkbox" id="inhalerEvening"><div class="chip-dot">‚úì</div><span class="chip-text">Inhaler PM</span></div>
          <div class="chip"><input type="checkbox" id="multiplication"><div class="chip-dot">‚úì</div><span class="chip-text">Math</span></div>
        </div>
      </div>
    </div>

    <div class="section" id="nutritionSection">
      <div class="sec-head"><div class="sec-title"><div class="sec-icon" style="--icon-start:#6dd5ed;--icon-end:#c471ed;--icon-glow:var(--glow-teal)">üíä</div><span class="sec-name">Supplements</span></div><span class="sec-toggle">‚ñº</span></div>
      <div class="sec-content">
        <div class="chips">
          <div class="chip"><input type="checkbox" id="creatine"><div class="chip-dot">‚úì</div><span class="chip-text">Creatine</span></div>
          <div class="chip"><input type="checkbox" id="vitaminD"><div class="chip-dot">‚úì</div><span class="chip-text">Vitamin D</span></div>
          <div class="chip"><input type="checkbox" id="no2"><div class="chip-dot">‚úì</div><span class="chip-text">NO2</span></div>
          <div class="chip"><input type="checkbox" id="psyllium"><div class="chip-dot">‚úì</div><span class="chip-text">Psyllium</span></div>
        </div>
      </div>
    </div>

    <div class="section" id="mealsSection">
      <div class="sec-head"><div class="sec-title"><div class="sec-icon" style="--icon-start:#ffa552;--icon-end:#ff6b9d;--icon-glow:var(--glow-orange)">üçΩÔ∏è</div><span class="sec-name">Meals</span></div><span class="sec-toggle">‚ñº</span></div>
      <div class="sec-content">
        <div class="chips" style="margin-bottom:12px">
          <div class="chip"><input type="checkbox" id="breakfast"><div class="chip-dot">‚úì</div><span class="chip-text">Breakfast</span></div>
          <div class="chip"><input type="checkbox" id="lunch"><div class="chip-dot">‚úì</div><span class="chip-text">Lunch</span></div>
          <div class="chip"><input type="checkbox" id="dinner"><div class="chip-dot">‚úì</div><span class="chip-text">Dinner</span></div>
        </div>
        <div class="chips">
          <div class="chip"><input type="checkbox" id="daySnacks"><div class="chip-dot">‚úì</div><span class="chip-text">Day Snacks</span></div>
          <div class="chip"><input type="checkbox" id="nightSnacks"><div class="chip-dot">‚úì</div><span class="chip-text">Night Snacks</span></div>
          <div class="chip"><input type="checkbox" id="noAlcohol"><div class="chip-dot">‚úì</div><span class="chip-text">No Alcohol</span></div>
        </div>
      </div>
    </div>

    <div class="section" id="movementSection">
      <div class="sec-head"><div class="sec-title"><div class="sec-icon" style="--icon-start:#ff6b9d;--icon-end:#c471ed;--icon-glow:var(--glow-pink)">üö∂</div><span class="sec-name">Movement Breaks</span></div><span class="sec-toggle">‚ñº</span></div>
      <div class="sec-content">
        <div id="movementList" class="items"></div>
        <button type="button" class="btn btn-secondary" id="addMovementBtn">+ Add Movement</button>
        <div class="card-avg" style="margin-top:10px">Daily avg: <span id="avgMovements">--</span></div>
      </div>
    </div>

    <div class="section" id="mentalHabitsSection">
      <div class="sec-head collapsed"><div class="sec-title"><div class="sec-icon" style="--icon-start:#c471ed;--icon-end:#6dd5ed;--icon-glow:var(--glow-purple)">üìñ</div><span class="sec-name">Reading</span></div><span class="sec-toggle">‚ñº</span></div>
      <div class="sec-content collapsed">
        <div id="readingList" class="items"></div>
        <button type="button" class="btn btn-secondary" id="addReadingBtn">+ Add Reading</button>
      </div>
    </div>

    <div class="section" id="meditationSection">
      <div class="sec-head"><div class="sec-title"><div class="sec-icon" style="--icon-start:#ffd93d;--icon-end:#ffa552;--icon-glow:var(--glow-orange)">üßò</div><span class="sec-name">Mindfulness</span></div><span class="sec-toggle">‚ñº</span></div>
      <div class="sec-content">
        <div class="chips"><div class="chip"><input type="checkbox" id="meditation"><div class="chip-dot">‚úì</div><span class="chip-text">Meditated</span></div></div>
      </div>
    </div>

    <div class="section" id="reflectionsSection">
      <div class="sec-head collapsed"><div class="sec-title"><div class="sec-icon" style="--icon-start:#c471ed;--icon-end:#ff6b9d;--icon-glow:var(--glow-purple)">‚úçÔ∏è</div><span class="sec-name">Reflections</span></div><span class="sec-toggle">‚ñº</span></div>
      <div class="sec-content collapsed"><textarea class="input" id="reflections" placeholder="What's on your mind?"></textarea></div>
    </div>

    <div class="section" id="storiesSection">
      <div class="sec-head collapsed"><div class="sec-title"><div class="sec-icon" style="--icon-start:#ff6b9d;--icon-end:#ffa552;--icon-glow:var(--glow-pink)">üìù</div><span class="sec-name">Grey & Sloane</span></div><span class="sec-toggle">‚ñº</span></div>
      <div class="sec-content collapsed"><textarea class="input" id="stories" placeholder="Capture their moments..."></textarea></div>
    </div>

    <div class="section" id="carlySection">
      <div class="sec-head collapsed"><div class="sec-title"><div class="sec-icon" style="--icon-start:#ffd93d;--icon-end:#ff6b9d;--icon-glow:var(--glow-orange)">üíõ</div><span class="sec-name">Carly</span></div><span class="sec-toggle">‚ñº</span></div>
      <div class="sec-content collapsed"><textarea class="input" id="carly" placeholder="Notes..."></textarea></div>
    </div>

    <div class="section" id="bodyDataSection">
      <div class="sec-head collapsed"><div class="sec-title"><div class="sec-icon" style="--icon-start:#6dd5ed;--icon-end:#c471ed;--icon-glow:var(--glow-teal)">‚öñÔ∏è</div><span class="sec-name">Body</span></div><span class="sec-toggle">‚ñº</span></div>
      <div class="sec-content collapsed">
        <div class="body-grid">
          <div class="body-cell"><div class="body-label">Weight</div><input type="number" inputmode="decimal" class="body-input" id="weight" step="0.1"></div>
          <div class="body-cell"><div class="body-label">Waist</div><input type="number" inputmode="decimal" class="body-input" id="waist" step="0.1"></div>
          <div class="body-cell"><div class="body-label">Lean Mass</div><input type="number" inputmode="decimal" class="body-input" id="leanMass" step="0.1"></div>
          <div class="body-cell"><div class="body-label">Lean %</div><div class="body-pct" id="leanMassPercent">--</div></div>
          <div class="body-cell"><div class="body-label">Body Fat</div><input type="number" inputmode="decimal" class="body-input" id="bodyFat" step="0.1"></div>
          <div class="body-cell"><div class="body-label">Fat %</div><div class="body-pct" id="bodyFatPercent">--</div></div>
          <div class="body-cell"><div class="body-label">Bone Mass</div><input type="number" inputmode="decimal" class="body-input" id="boneMass" step="0.1"></div>
          <div class="body-cell"><div class="body-label">Bone %</div><div class="body-pct" id="boneMassPercent">--</div></div>
          <div class="body-cell"><div class="body-label">Water (lbs)</div><input type="number" inputmode="decimal" class="body-input" id="water" step="0.1"></div>
          <div class="body-cell"><div class="body-label">Water %</div><div class="body-pct" id="waterPercent">--</div></div>
        </div>
      </div>
    </div>

    <div class="section" id="bloodPressureSection">
      <div class="sec-head collapsed"><div class="sec-title"><div class="sec-icon" style="--icon-start:#ff6b9d;--icon-end:#c471ed;--icon-glow:var(--glow-pink)">‚ù§Ô∏è</div><span class="sec-name">Blood Pressure</span></div><span class="sec-toggle">‚ñº</span></div>
      <div class="sec-content collapsed">
        <div class="body-grid">
          <div class="body-cell"><div class="body-label">Systolic</div><input type="number" inputmode="numeric" class="body-input" id="systolic"></div>
          <div class="body-cell"><div class="body-label">Diastolic</div><input type="number" inputmode="numeric" class="body-input" id="diastolic"></div>
          <div class="body-cell"><div class="body-label">Heart Rate</div><input type="number" inputmode="numeric" class="body-input" id="heartRate"></div>
          <div class="body-cell"><div class="body-label">Status</div><div class="body-pct" id="bpStatus">--</div></div>
        </div>
      </div>
    </div>
  </form>

  <div id="chartsPage" style="display:none">
    <header class="header">
      <div class="header-top">
        <div class="brand"><div class="logo">üìä</div><div><h1>Charts</h1><div class="tagline" id="chartsSubtitle">Last 7 Days</div></div></div>
        <button type="button" id="chartsCloseBtn" class="nav-link">‚úï</button>
      </div>
      <div style="display:flex;gap:8px;margin-top:16px">
        <button type="button" class="range-btn btn btn-secondary active" data-range="7">7 Days</button>
        <button type="button" class="range-btn btn btn-secondary" data-range="30">30 Days</button>
        <button type="button" class="range-btn btn btn-secondary" data-range="all">All</button>
      </div>
    </header>
    <div class="section"><div class="sec-name">Weight</div><canvas id="weightChart" style="max-height:220px"></canvas></div>
    <div class="section"><div class="sec-name">Sleep</div><canvas id="sleepChart" style="max-height:220px"></canvas></div>
    <div class="section"><div class="sec-name">Steps</div><canvas id="stepsChart" style="max-height:220px"></canvas></div>
    <div class="section"><div class="sec-name">REHIT</div><canvas id="rehitChart" style="max-height:220px"></canvas></div>
    <div class="section"><div class="sec-name">Body Comp</div><canvas id="bodyCompChart" style="max-height:220px"></canvas></div>
    <div class="section"><div class="sec-name">Blood Pressure</div><canvas id="bpChart" style="max-height:220px"></canvas></div>
  </div>

  <div id="biomarkersPage" style="display:none">
    <header class="header">
      <div class="header-top">
        <div class="brand"><div class="logo">üß¨</div><div><h1>Biomarkers</h1><div class="tagline" id="biomarkersSubtitle">Most recent: --</div></div></div>
        <button type="button" id="biomarkersCloseBtn" class="nav-link">‚úï</button>
      </div>
    </header>
    <div class="section">
      <div class="field"><label class="field-label">Lab Date</label><input type="text" class="input" id="biomarkersDate" placeholder="M/D/YY"></div>
      <div id="biomarkersTable"></div>
      <button type="button" class="btn btn-primary" id="biomarkersSubmitBtn" style="width:100%;margin-top:14px">Submit</button>
      <div id="biomarkersSaveStatus" style="text-align:center;margin-top:8px;color:var(--accent-teal)"></div>
    </div>
  </div>

  <div id="weeklySummaryPage" style="display:none">
    <header class="header">
      <div class="header-top">
        <div class="brand"><div class="logo">üìà</div><div><h1>Summary</h1><div class="tagline" id="summarySubtitle">This Week</div></div></div>
        <button type="button" id="summaryCloseBtn" class="nav-link">‚úï</button>
      </div>
    </header>
    <div class="section" style="text-align:center">
      <div style="font-family:'Space Grotesk';font-size:48px;font-weight:700;background:linear-gradient(90deg,var(--accent-teal),var(--accent-purple),var(--accent-pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent" id="phaseDaysComplete">--</div>
      <div style="font-size:13px;color:var(--text-dim)">days completed</div>
      <div class="phase-track" style="margin-top:14px"><div class="phase-fill" id="summaryPhaseBar" style="width:0%"></div></div>
    </div>
    <div class="section"><div class="sec-name" style="margin-bottom:12px">This Week</div><div id="weeklyStats" style="display:grid;grid-template-columns:1fr 1fr;gap:10px"></div></div>
    <div class="section"><div class="sec-name" style="margin-bottom:12px">Streaks üî•</div><div id="streaksDisplay"></div></div>
    <div class="section"><div class="sec-name" style="margin-bottom:12px">Wins üèÜ</div><div id="winsDisplay"></div></div>
    <div class="section"><div class="sec-name" style="margin-bottom:12px">vs Last Week</div><div id="weekComparisonDisplay"></div></div>
  </div>

  <!-- Settings Page -->
  <div id="settingsPage" style="display:none">
    <header class="header">
      <div class="header-top">
        <div class="brand"><div class="logo">‚öôÔ∏è</div><div><h1>Settings</h1><div class="tagline">Customize your experience</div></div></div>
        <button type="button" id="settingsCloseBtn" class="nav-link">‚úï</button>
      </div>
    </header>
    
    <!-- Theme Settings -->
    <div class="section">
      <div class="sec-head"><div class="sec-title"><div class="sec-icon" style="--icon-start:var(--accent-orange);--icon-end:var(--accent-yellow);--icon-glow:var(--glow-orange)">üåó</div><span class="sec-name">Theme Schedule</span></div></div>
      <div class="sec-content">
        <div class="setting-row">
          <div class="setting-label">
            <span class="setting-title">‚òÄÔ∏è Day Mode Starts</span>
            <span class="setting-desc">When to switch to bright theme</span>
          </div>
          <input type="time" class="time-input" id="dayStartTime" value="06:00">
        </div>
        <div class="setting-row">
          <div class="setting-label">
            <span class="setting-title">üåô Night Mode Starts</span>
            <span class="setting-desc">When to switch to dark theme</span>
          </div>
          <input type="time" class="time-input" id="nightStartTime" value="18:00">
        </div>
        <div class="setting-row">
          <div class="setting-label">
            <span class="setting-title">Current Theme</span>
            <span class="setting-desc" id="currentThemeDisplay">Auto</span>
          </div>
          <div class="theme-preview">
            <button type="button" class="theme-btn" data-theme="day" title="Day">‚òÄÔ∏è</button>
            <button type="button" class="theme-btn" data-theme="night" title="Night">üåô</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Section Management -->
    <div class="section">
      <div class="sec-head"><div class="sec-title"><div class="sec-icon" style="--icon-start:var(--accent-purple);--icon-end:var(--accent-pink);--icon-glow:var(--glow-purple)">üìë</div><span class="sec-name">Manage Sections</span></div></div>
      <div class="sec-content">
        <p style="font-size:12px;color:var(--text-muted);margin-bottom:12px">Drag to reorder ‚Ä¢ Toggle to show/hide</p>
        <div id="sectionList" class="section-list">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>
    
    <!-- Add Custom Section -->
    <div class="section">
      <div class="sec-head"><div class="sec-title"><div class="sec-icon" style="--icon-start:var(--accent-teal);--icon-end:var(--accent-purple);--icon-glow:var(--glow-teal)">‚ûï</div><span class="sec-name">Add Custom Section</span></div></div>
      <div class="sec-content">
        <div class="field">
          <label class="field-label">Section Name</label>
          <input type="text" class="input" id="newSectionName" placeholder="e.g., Gratitude, Goals, etc.">
        </div>
        <div class="field">
          <label class="field-label">Section Type</label>
          <select class="input" id="newSectionType">
            <option value="text">Text/Notes</option>
            <option value="checkbox">Checkboxes</option>
            <option value="number">Number Input</option>
          </select>
        </div>
        <div class="field">
          <label class="field-label">Icon (emoji)</label>
          <input type="text" class="input" id="newSectionIcon" placeholder="üìù" maxlength="2" style="width:80px">
        </div>
        <button type="button" class="btn btn-primary" id="addSectionBtn" style="width:100%;margin-top:8px">Add Section</button>
      </div>
    </div>
    
    <!-- Data Management -->
    <div class="section">
      <div class="sec-head"><div class="sec-title"><div class="sec-icon" style="--icon-start:var(--accent-pink);--icon-end:var(--accent-orange);--icon-glow:var(--glow-pink)">üíæ</div><span class="sec-name">Data</span></div></div>
      <div class="sec-content">
        <button type="button" class="btn btn-secondary" id="exportSettingsBtn" style="width:100%;margin-bottom:8px">Export Settings</button>
        <button type="button" class="btn btn-secondary" id="importSettingsBtn" style="width:100%">Import Settings</button>
        <input type="file" id="importSettingsFile" accept=".json" style="display:none">
      </div>
    </div>
  </div>

  <button id="quickLogFab" class="fab">+</button>
  <div id="quickLogMenu" class="fab-menu">
    <button class="fab-item quick-log-item" data-action="movement"><div class="fab-icon" style="background:linear-gradient(135deg,var(--accent-pink),var(--accent-purple))">üö∂</div><span class="fab-label">Movement</span></button>
    <button class="fab-item quick-log-item" data-action="water"><div class="fab-icon" style="background:linear-gradient(135deg,var(--accent-teal),var(--accent-purple))">üíß</div><span class="fab-label">Water</span></button>
    <button class="fab-item quick-log-item" data-action="reading"><div class="fab-icon" style="background:linear-gradient(135deg,var(--accent-purple),var(--accent-pink))">üìñ</div><span class="fab-label">Reading</span></button>
    <button class="fab-item quick-log-item" data-action="rehit"><div class="fab-icon" style="background:linear-gradient(135deg,var(--accent-orange),var(--accent-pink))">üö¥</div><span class="fab-label">REHIT</span></button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
  <script src="app.js" defer></script>
  <script>
    // Sync all chip visuals
    function syncAllChips() {
      document.querySelectorAll('.chip').forEach(c => {
        const cb = c.querySelector('input[type="checkbox"]');
        if (cb) c.classList.toggle('on', cb.checked);
      });
    }
    
    // Chip toggle
    document.querySelectorAll('.chip').forEach(c=>{
      c.addEventListener('click',e=>{
        if(e.target.type==='checkbox')return;
        const cb=c.querySelector('input[type="checkbox"]');
        if(cb){cb.checked=!cb.checked;cb.dispatchEvent(new Event('change',{bubbles:true}))}
      });
      const cb=c.querySelector('input[type="checkbox"]');
      if(cb)cb.addEventListener('change',()=>c.classList.toggle('on',cb.checked));
    });
    
    // Water progress bar (goal: 6)
    function updateWaterBar(){
      const waterCount = document.getElementById('waterCount');
      const fill = document.getElementById('waterBarFill');
      if(!waterCount || !fill) return;
      const count = parseInt(waterCount.textContent) || 0;
      const goal = 6;
      const pct = Math.min(100, (count / goal) * 100);
      fill.style.height = pct + '%';
    }
    
    // Steps progress bar (goal: 7500)
    function updateStepsBar(){
      const stepsInput = document.getElementById('steps');
      const fill = document.getElementById('stepsBarFill');
      if(!stepsInput || !fill) return;
      const steps = parseInt(stepsInput.value) || 0;
      const goal = 7500;
      const pct = Math.min(100, (steps / goal) * 100);
      fill.style.height = pct + '%';
    }
    
    // REHIT dots - count sessions this week
    function updateRehitDots() {
      const dotsContainer = document.getElementById('rehitDots');
      if (!dotsContainer) return;
      const dots = dotsContainer.querySelectorAll('.rehit-dot');
      
      // Count REHIT sessions this week from chartDataCache if available
      let weekCount = 0;
      if (typeof chartDataCache !== 'undefined' && chartDataCache && chartDataCache.length > 0) {
        const today = new Date();
        const startOfWeek = new Date(today);
        startOfWeek.setDate(today.getDate() - today.getDay()); // Sunday
        startOfWeek.setHours(0,0,0,0);
        
        chartDataCache.forEach(day => {
          const dayDate = new Date(day.date);
          if (dayDate >= startOfWeek) {
            if (day.rehit === '2x10' || day.rehit === '3x10' || day.rehit === true || day.rehit === 'TRUE') {
              weekCount++;
            }
          }
        });
      }
      
      // Also check current day's checkboxes
      const rehit2 = document.getElementById('rehit2');
      const rehit3 = document.getElementById('rehit3');
      const todayHasRehit = (rehit2 && rehit2.checked) || (rehit3 && rehit3.checked);
      
      // Update dots (max 4)
      dots.forEach((dot, i) => {
        dot.classList.toggle('on', i < Math.min(weekCount, 4));
      });
    }
    
    // Hook populateForm
    const originalPopulateForm = window.populateForm;
    window.populateForm = function(...args) {
      if (originalPopulateForm) originalPopulateForm.apply(this, args);
      setTimeout(() => { 
        syncAllChips(); 
        updateWaterBar(); 
        updateRehitDisplay(); 
        updateStepsBar(); 
        updateRehitDots();
      }, 100);
    };
    
    // Hook water display updates
    const origWater=window.updateWaterDisplay;
    window.updateWaterDisplay=function(){
      if(origWater)origWater();
      updateWaterBar();
    };
    
    // Watch for water count text changes with MutationObserver
    document.addEventListener('DOMContentLoaded', () => {
      const waterCount = document.getElementById('waterCount');
      if (waterCount) {
        const observer = new MutationObserver(updateWaterBar);
        observer.observe(waterCount, { childList: true, characterData: true, subtree: true });
      }
    });
    
    // Steps input listener
    document.addEventListener('DOMContentLoaded',()=>{
      const stepsInput = document.getElementById('steps');
      if(stepsInput) {
        stepsInput.addEventListener('input', updateStepsBar);
        stepsInput.addEventListener('change', updateStepsBar);
      }
      
      // REHIT checkbox listeners for dots
      const rehit2 = document.getElementById('rehit2');
      const rehit3 = document.getElementById('rehit3');
      if(rehit2) rehit2.addEventListener('change', updateRehitDots);
      if(rehit3) rehit3.addEventListener('change', updateRehitDots);
      
      // Initialize everything after a delay to let app.js load data
      setTimeout(()=>{ 
        syncAllChips(); 
        updateWaterBar(); 
        updateStepsBar();
        updateRehitDots();
        // Call app.js phase functions if they exist
        if(typeof updatePhaseInfo === 'function') updatePhaseInfo();
        if(typeof loadPhaseProgress === 'function') loadPhaseProgress();
      }, 800);
      
      // Also update after chart data loads (longer delay)
      setTimeout(updateRehitDots, 2000);
    });
    
    // Section collapse
    document.querySelectorAll('.sec-head').forEach(h=>{
      h.addEventListener('click',()=>{
        h.classList.toggle('collapsed');
        const c=h.nextElementSibling;if(c&&c.classList.contains('sec-content'))c.classList.toggle('collapsed');
      });
    });
    
    // REHIT Modal
    function openRehitModal() { document.getElementById('rehitModal').classList.add('show'); }
    function closeRehitModal() { document.getElementById('rehitModal').classList.remove('show'); }
    function saveRehitAndClose() { updateRehitDisplay(); closeRehitModal(); if(typeof triggerSaveSoon==='function')triggerSaveSoon(); }
    
    function updateRehitDisplay() {
      const score=document.getElementById('fitnessScore')?.value;
      const cals=document.getElementById('calories')?.value;
      const watts=document.getElementById('peakWatts')?.value;
      const ws=document.getElementById('wattSeconds')?.value;
      const rehit2=document.getElementById('rehit2')?.checked;
      const rehit3=document.getElementById('rehit3')?.checked;
      const statsDiv=document.getElementById('rehitStats');
      if(statsDiv){const hasData=score||cals||watts||ws;const isChecked=rehit2||rehit3;statsDiv.style.display=(isChecked||hasData)?'block':'none'}
      document.getElementById('rehitScoreDisplay').textContent=score||'--';
      document.getElementById('rehitCalsDisplay').textContent=cals||'--';
      document.getElementById('rehitWattsDisplay').textContent=watts||'--';
      document.getElementById('rehitWsDisplay').textContent=ws?parseInt(ws).toLocaleString():'--';
    }
    
    document.addEventListener('DOMContentLoaded', () => {
      const rehit2=document.getElementById('rehit2');
      const rehit3=document.getElementById('rehit3');
      const editBtn=document.getElementById('editRehitBtn');
      const showModal=(e)=>{if(e.target.checked)setTimeout(openRehitModal,300);updateRehitDisplay()};
      if(rehit2)rehit2.addEventListener('change',showModal);
      if(rehit3)rehit3.addEventListener('change',showModal);
      if(editBtn)editBtn.addEventListener('click',openRehitModal);
      ['fitnessScore','calories','peakWatts','wattSeconds'].forEach(id=>{const el=document.getElementById(id);if(el)el.addEventListener('change',updateRehitDisplay)});
      setTimeout(updateRehitDisplay,1000);
    });
    
    document.getElementById('rehitModal')?.addEventListener('click',(e)=>{if(e.target.id==='rehitModal')closeRehitModal()});
    
    // =============================================
    // SETTINGS & THEME SYSTEM
    // =============================================
    
    // Default settings
    const defaultSettings = {
      dayStartTime: '05:00',
      nightStartTime: '17:00',
      sections: [
        { id: 'greysHabitsSection', name: "Grey's Habits", icon: 'üë∂', visible: true, custom: false },
        { id: 'nutritionSection', name: 'Supplements', icon: 'üíä', visible: true, custom: false },
        { id: 'mealsSection', name: 'Meals', icon: 'üçΩÔ∏è', visible: true, custom: false },
        { id: 'movementSection', name: 'Movement Breaks', icon: 'üö∂', visible: true, custom: false },
        { id: 'mentalHabitsSection', name: 'Reading', icon: 'üìñ', visible: true, custom: false },
        { id: 'meditationSection', name: 'Mindfulness', icon: 'üßò', visible: true, custom: false },
        { id: 'reflectionsSection', name: 'Reflections', icon: '‚úçÔ∏è', visible: true, custom: false },
        { id: 'storiesSection', name: 'Grey & Sloane', icon: 'üìù', visible: true, custom: false },
        { id: 'carlySection', name: 'Carly', icon: 'üíõ', visible: true, custom: false },
        { id: 'bodyDataSection', name: 'Body', icon: '‚öñÔ∏è', visible: true, custom: false },
        { id: 'bloodPressureSection', name: 'Blood Pressure', icon: '‚ù§Ô∏è', visible: true, custom: false },
      ]
    };
    
    // Load settings from localStorage
    function loadSettings() {
      try {
        const saved = localStorage.getItem('elevateSettings');
        if (saved) {
          return { ...defaultSettings, ...JSON.parse(saved) };
        }
      } catch (e) {
        console.error('Error loading settings:', e);
      }
      return { ...defaultSettings };
    }
    
    // Save settings to localStorage
    function saveSettings(settings) {
      try {
        localStorage.setItem('elevateSettings', JSON.stringify(settings));
      } catch (e) {
        console.error('Error saving settings:', e);
      }
    }
    
    let appSettings = loadSettings();
    
    // Theme functions
    function getCurrentTheme() {
      const now = new Date();
      const currentTime = now.getHours() * 60 + now.getMinutes();
      
      const [dayH, dayM] = appSettings.dayStartTime.split(':').map(Number);
      const [nightH, nightM] = appSettings.nightStartTime.split(':').map(Number);
      
      const dayStart = dayH * 60 + dayM;
      const nightStart = nightH * 60 + nightM;
      
      if (currentTime >= dayStart && currentTime < nightStart) {
        return 'day';
      } else {
        return 'night';
      }
    }
    
    function applyTheme(theme, showIndicator = false) {
      const body = document.body;
      const indicator = document.getElementById('themeIndicator');
      
      body.classList.remove('day-mode', 'sunset-mode');
      
      if (theme === 'day') {
        body.classList.add('day-mode');
        if (indicator) indicator.innerHTML = '‚òÄÔ∏è Day Mode';
      } else {
        if (indicator) indicator.innerHTML = 'üåô Night Mode';
      }
      
      // Update theme buttons
      document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.theme === theme);
      });
      
      // Update display
      const display = document.getElementById('currentThemeDisplay');
      if (display) display.textContent = theme === 'day' ? 'Day Mode' : 'Night Mode';
      
      if (showIndicator && indicator) {
        indicator.classList.add('show');
        setTimeout(() => indicator.classList.remove('show'), 2000);
      }
    }
    
    // Initialize theme
    let currentTheme = getCurrentTheme();
    applyTheme(currentTheme, false);
    
    // Check for theme changes every minute
    setInterval(() => {
      const newTheme = getCurrentTheme();
      if (newTheme !== currentTheme) {
        currentTheme = newTheme;
        applyTheme(newTheme, true);
      }
    }, 60000);
    
    // =============================================
    // SETTINGS PAGE
    // =============================================
    
    function openSettingsPage() {
      document.getElementById('healthForm').style.display = 'none';
      document.getElementById('settingsPage').style.display = 'block';
      document.getElementById('quickLogFab').style.display = 'none';
      
      // Populate settings
      document.getElementById('dayStartTime').value = appSettings.dayStartTime;
      document.getElementById('nightStartTime').value = appSettings.nightStartTime;
      
      renderSectionList();
    }
    
    function closeSettingsPage() {
      document.getElementById('settingsPage').style.display = 'none';
      document.getElementById('healthForm').style.display = 'block';
      document.getElementById('quickLogFab').style.display = 'block';
      
      // Apply section visibility
      applySectionSettings();
    }
    
    function renderSectionList() {
      const list = document.getElementById('sectionList');
      if (!list) return;
      
      list.innerHTML = appSettings.sections.map((sec, idx) => `
        <div class="section-item" draggable="true" data-idx="${idx}" data-id="${sec.id}">
          <span class="section-item-drag">‚ãÆ‚ãÆ</span>
          <span class="section-item-icon">${sec.icon}</span>
          <span class="section-item-name">${sec.name}</span>
          <div class="section-item-toggle ${sec.visible ? 'on' : ''}" data-idx="${idx}"></div>
          ${sec.custom ? `<button class="section-item-delete" data-idx="${idx}">üóëÔ∏è</button>` : ''}
        </div>
      `).join('');
      
      // Add event listeners
      list.querySelectorAll('.section-item-toggle').forEach(toggle => {
        toggle.addEventListener('click', () => {
          const idx = parseInt(toggle.dataset.idx);
          appSettings.sections[idx].visible = !appSettings.sections[idx].visible;
          toggle.classList.toggle('on');
          saveSettings(appSettings);
        });
      });
      
      list.querySelectorAll('.section-item-delete').forEach(btn => {
        btn.addEventListener('click', () => {
          const idx = parseInt(btn.dataset.idx);
          if (confirm('Delete this section?')) {
            appSettings.sections.splice(idx, 1);
            saveSettings(appSettings);
            renderSectionList();
          }
        });
      });
      
      // Drag and drop
      setupDragAndDrop();
    }
    
    function setupDragAndDrop() {
      const items = document.querySelectorAll('.section-item');
      let draggedItem = null;
      
      items.forEach(item => {
        item.addEventListener('dragstart', (e) => {
          draggedItem = item;
          item.classList.add('dragging');
          e.dataTransfer.effectAllowed = 'move';
        });
        
        item.addEventListener('dragend', () => {
          item.classList.remove('dragging');
          document.querySelectorAll('.section-item').forEach(i => i.classList.remove('drag-over'));
          draggedItem = null;
        });
        
        item.addEventListener('dragover', (e) => {
          e.preventDefault();
          if (item !== draggedItem) {
            item.classList.add('drag-over');
          }
        });
        
        item.addEventListener('dragleave', () => {
          item.classList.remove('drag-over');
        });
        
        item.addEventListener('drop', (e) => {
          e.preventDefault();
          if (item !== draggedItem && draggedItem) {
            const fromIdx = parseInt(draggedItem.dataset.idx);
            const toIdx = parseInt(item.dataset.idx);
            
            // Reorder array
            const [moved] = appSettings.sections.splice(fromIdx, 1);
            appSettings.sections.splice(toIdx, 0, moved);
            
            saveSettings(appSettings);
            renderSectionList();
            applySectionSettings();
          }
        });
      });
    }
    
    function applySectionSettings() {
      const form = document.getElementById('healthForm');
      if (!form) return;
      
      // Apply visibility and order
      appSettings.sections.forEach((sec, idx) => {
        const el = document.getElementById(sec.id);
        if (el) {
          el.style.display = sec.visible ? '' : 'none';
          el.style.order = idx;
        }
      });
    }
    
    // Wire up settings page
    document.getElementById('settingsBtn')?.addEventListener('click', (e) => {
      e.preventDefault();
      openSettingsPage();
    });
    
    document.getElementById('settingsCloseBtn')?.addEventListener('click', closeSettingsPage);
    
    // Time inputs
    document.getElementById('dayStartTime')?.addEventListener('change', (e) => {
      appSettings.dayStartTime = e.target.value;
      saveSettings(appSettings);
      currentTheme = getCurrentTheme();
      applyTheme(currentTheme, true);
    });
    
    document.getElementById('nightStartTime')?.addEventListener('change', (e) => {
      appSettings.nightStartTime = e.target.value;
      saveSettings(appSettings);
      currentTheme = getCurrentTheme();
      applyTheme(currentTheme, true);
    });
    
    // Theme preview buttons
    document.querySelectorAll('.theme-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        currentTheme = btn.dataset.theme;
        applyTheme(currentTheme, true);
      });
    });
    
    // Add custom section
    document.getElementById('addSectionBtn')?.addEventListener('click', () => {
      const name = document.getElementById('newSectionName').value.trim();
      const type = document.getElementById('newSectionType').value;
      const icon = document.getElementById('newSectionIcon').value || 'üìù';
      
      if (!name) {
        alert('Please enter a section name');
        return;
      }
      
      const id = 'custom_' + Date.now();
      
      appSettings.sections.push({
        id,
        name,
        icon,
        visible: true,
        custom: true,
        type
      });
      
      saveSettings(appSettings);
      
      // Create the section element
      createCustomSection(id, name, icon, type);
      
      // Clear inputs
      document.getElementById('newSectionName').value = '';
      document.getElementById('newSectionIcon').value = '';
      
      renderSectionList();
    });
    
    function createCustomSection(id, name, icon, type) {
      const form = document.getElementById('healthForm');
      if (!form) return;
      
      const section = document.createElement('div');
      section.className = 'section';
      section.id = id;
      
      let content = '';
      if (type === 'text') {
        content = `<textarea class="input" id="${id}_input" placeholder="Enter notes..."></textarea>`;
      } else if (type === 'checkbox') {
        content = `<div class="chips"><div class="chip"><input type="checkbox" id="${id}_check"><div class="chip-dot">‚úì</div><span class="chip-text">Done</span></div></div>`;
      } else if (type === 'number') {
        content = `<input type="number" class="input" id="${id}_input" placeholder="0">`;
      }
      
      section.innerHTML = `
        <div class="sec-head collapsed">
          <div class="sec-title">
            <div class="sec-icon" style="--icon-start:var(--accent-purple);--icon-end:var(--accent-pink)">${icon}</div>
            <span class="sec-name">${name}</span>
          </div>
          <span class="sec-toggle">‚ñº</span>
        </div>
        <div class="sec-content collapsed">${content}</div>
      `;
      
      form.appendChild(section);
      
      // Wire up collapse
      const head = section.querySelector('.sec-head');
      head.addEventListener('click', () => {
        head.classList.toggle('collapsed');
        section.querySelector('.sec-content').classList.toggle('collapsed');
      });
      
      // Wire up chip if checkbox type
      if (type === 'checkbox') {
        const chip = section.querySelector('.chip');
        const cb = chip.querySelector('input');
        chip.addEventListener('click', (e) => {
          if (e.target.type !== 'checkbox') {
            cb.checked = !cb.checked;
            chip.classList.toggle('on', cb.checked);
          }
        });
        cb.addEventListener('change', () => chip.classList.toggle('on', cb.checked));
      }
    }
    
    // Export/Import settings
    document.getElementById('exportSettingsBtn')?.addEventListener('click', () => {
      const data = JSON.stringify(appSettings, null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'elevate-settings.json';
      a.click();
      URL.revokeObjectURL(url);
    });
    
    document.getElementById('importSettingsBtn')?.addEventListener('click', () => {
      document.getElementById('importSettingsFile').click();
    });
    
    document.getElementById('importSettingsFile')?.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (evt) => {
        try {
          const imported = JSON.parse(evt.target.result);
          appSettings = { ...defaultSettings, ...imported };
          saveSettings(appSettings);
          renderSectionList();
          applySectionSettings();
          currentTheme = getCurrentTheme();
          applyTheme(currentTheme, true);
          alert('Settings imported successfully!');
        } catch (err) {
          alert('Error importing settings: ' + err.message);
        }
      };
      reader.readAsText(file);
    });
    
    // Initialize section settings on load
    document.addEventListener('DOMContentLoaded', () => {
      applySectionSettings();
      
      // Recreate any custom sections
      appSettings.sections.filter(s => s.custom).forEach(sec => {
        if (!document.getElementById(sec.id)) {
          createCustomSection(sec.id, sec.name, sec.icon, sec.type);
        }
      });
    });
  </script>
</body>
</html>
